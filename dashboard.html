<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BrainHustle‚Ñ¢ Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0a0a0a;
      color: white;
      text-align: center;
    }

    .menu-button {
      position: fixed;
      top: 20px;
      left: 20px;
      background-color: #00e676;
      color: black;
      font-size: 18px;
      padding: 10px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1000;
    }

    .logo-container { margin-top: 80px; }
    .logo-container img { height: 192px; }

    h1 { color: #00e676; margin-top: 20px; }

    .content {
      max-width: 800px;
      margin: 30px auto;
      padding: 0 20px;
      text-align: left;
    }

    .content h2 { color: #00e676; margin-bottom: 10px; }
    .content p { margin-bottom: 20px; line-height: 1.6; }

    .footer { margin-top: 40px; font-size: 12px; color: gray; padding: 20px; }

    /* Sidebar */
    .sidebar {
      height: 100%;
      width: 0;
      position: fixed;
      top: 0;
      left: 0;
      background-color: #111;
      overflow-x: hidden;
      transition: 0.3s;
      padding-top: 60px;
      z-index: 1001;
      text-align: left; /* ADDED: keeps badge aligned nicely */
    }

    .sidebar a {
      padding: 10px 20px;
      text-decoration: none;
      font-size: 18px;
      color: #00e676;
      display: block;
    }
    .sidebar a:hover { background-color: #222; }
    .close-btn { position: absolute; top: 10px; right: 20px; font-size: 24px; color: white; cursor: pointer; }

    /* Top status banner */
    .statusbar {
      position: fixed;
      top: 0; left: 0; right: 0;
      background:#00e676; color:#000;
      padding: 10px 14px;
      font-weight: 700;
      display: none; /* shown by JS */
      z-index: 1100;
    }
    .statusbar.error { background:#ff5252; color:#fff; }
    .status-actions { margin-left:8px; display:inline-block; }
    .status-actions button {
      background:#000; color:#00e676; border:1px solid #000;
      padding:6px 10px; border-radius:6px; cursor:pointer;
    }
  </style>
</head>
<body>

  <!-- Top status banner -->
  <div id="statusbar" class="statusbar"></div>

  <!-- Side Menu -->
  <div id="sideMenu" class="sidebar">
    <span class="close-btn" onclick="closeMenu()">&times;</span>
    <a href="dashboard.html">Dashboard</a>
    <a href="kits.html">Hustle Kits</a>
    <a href="ideas.html">Money Ideas</a>
    <a href="passive.html">Passive Income</a>
    <a href="ai-tools.html">AI Tools</a>
    <a href="monetization.html">Monetization</a>
    <a href="trackers.html">Trackers</a>
    <a href="about.html">What is BrainHustle‚Ñ¢?</a>

    <!-- ADDED: direct link to your Sports Systems page -->
    <a href="sports-systems.html">üèà Sports Systems</a>

    <!-- ADDED: green badge (hidden by default) -->
    <div id="memberStatus" style="padding:10px 20px;color:#00e676;font-size:14px;display:none">
      Status: Upgraded ‚úÖ
    </div>

    <!-- ADDED: upgrade link (we‚Äôll hide this if you‚Äôre upgraded) -->
    <a id="upgradeLink" href="upgrade.html">‚¨ÜÔ∏è Upgrade Access</a>

    <a href="login.html" onclick="logout()">Logout</a>
  </div>

  <!-- Menu Button -->
  <button class="menu-button" onclick="openMenu()">‚ò∞ Menu</button>

  <!-- Logo -->
  <div class="logo-container">
    <img src="brainhustle-logo.PNG" alt="BrainHustle Logo">
  </div>

  <h1>Welcome to BrainHustle‚Ñ¢</h1>

  <div class="content">
    <h2>Thank You for Joining</h2>
    <p>You‚Äôre officially part of BrainHustle‚Ñ¢ ‚Äî where smart systems, real tools, and proven strategies meet. You didn‚Äôt just join ‚Äî you invested in yourself, your future, and your ability to take action. No fluff. No hype. Just real results waiting for you.</p>

    <h2>Your Next Move</h2>
    <p>‚úîÔ∏è Start with Hustle Kits ‚Äî fast tools to get moving  
       ‚úîÔ∏è Explore Money Ideas ‚Äî real ways to earn  
       ‚úîÔ∏è Use AI Tools ‚Äî save time, boost results  
       ‚úîÔ∏è Track everything ‚Äî stay focused, grow faster</p>

    <h2>You‚Äôre in Control Now</h2>
    <p>This dashboard is your launchpad. Use the menu to access everything. Build income your way ‚Äî and make BrainHustle‚Ñ¢ your personal profit system.</p>

    <p>Let‚Äôs get to work. Your hustle starts now.</p>

    <h2>Disclaimer</h2>
    <p>BrainHustle‚Ñ¢ is for educational purposes only. We do not guarantee earnings or results. All tools, ideas, and systems provided are for informational use and should be used at your own discretion. BrainHustle‚Ñ¢ is not financial, legal, or investment advice. Individual success depends on effort, experience, and execution.</p>
  </div>

  <div class="footer">
    All Rights Reserved ¬© BrainHustle‚Ñ¢ 2025
  </div>

  <!-- Sidebar Script -->
  <script>
    function openMenu() { document.getElementById("sideMenu").style.width = "250px"; }
    function closeMenu() { document.getElementById("sideMenu").style.width = "0"; }
  </script>

  <!-- Firebase Logout + Auto-Admin with visible status + retry (kept as-is) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
    /* ADDED: Realtime Database imports (free plan status check) */
    import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA1cS4bIOxNAQuDFsyRq6mGzz9xeKqKFiY",
      authDomain: "brainhustle-92a40.firebaseapp.com",
      projectId: "brainhustle-92a40",
      storageBucket: "brainhustle-92a40.appspot.com",
      messagingSenderId: "547592914180",
      appId: "1:547592914180:web:be4969f6a657c2b6c9bc51",
      measurementId: "G-3M5PKR5S27",
      /* ADDED: include your RTDB URL */
      databaseURL: "https://brainhustle-92a40-default-rtdb.firebaseio.com"
    };

    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    /* ADDED: RTDB handle */
    const rtdb = getDatabase(app);

    const STATUS = document.getElementById('statusbar');
    function showStatus(msg, isError=false, withRetry=false, user=null){
      STATUS.className = 'statusbar' + (isError ? ' error' : '');
      STATUS.innerHTML = msg + (withRetry ? `<span class="status-actions"><button id="forceBtn">Force Upgrade</button></span>` : '');
      STATUS.style.display = 'block';
      if (withRetry && user) {
        document.getElementById('forceBtn').onclick = () => ensureAdmin(user, true);
      }
    }

    window.logout = function() {
      signOut(auth).then(() => { window.location.href = "login.html"; });
    };

    async function ensureAdmin(user, showResult=false){
      const ADMIN_EMAILS = ["shawn.murrayjr@gmail.com"];
      if (!ADMIN_EMAILS.includes((user.email || '').toLowerCase())) {
        if (showResult) showStatus(`Logged in as ${user.email}. (Not in ADMIN_EMAILS)`, true);
        return;
      }
      try {
        /* keeping your Firestore write (unchanged) */
        await setDoc(doc(db, "users", user.uid), {
          email: user.email,
          membership: "upgraded",
          role: "admin",
          updatedAt: new Date()
        }, { merge: true });

        const snap = await getDoc(doc(db, "users", user.uid));
        const data = snap.exists() ? snap.data() : {};
        const level = (data.membership || 'starter').toLowerCase();
        showStatus(`‚úÖ ${user.email} is set to ${level.toUpperCase()} (role: ${data.role || 'n/a'}). You‚Äôre good to go.`, false);
      } catch (e) {
        console.error('Auto-admin error:', e);
        showStatus(`‚ö†Ô∏è Could not update Firestore (permissions?).`, true, true, user);
      }
    }

    /* ADDED: RTDB membership check to toggle the menu badge + upgrade link */
    const memberStatus = document.getElementById("memberStatus");
    const upgradeLink  = document.getElementById("upgradeLink");
    const OWNER_UID    = "bMPlkmhEV8a05M0uwsgxVORsFk72";
    const emailKey     = (e)=> e.toLowerCase().replace(/\./g, ',');

    async function setMenuByLevel(level){
      if (String(level).toLowerCase() === "upgraded") {
        if (memberStatus) memberStatus.style.display = "block";
        if (upgradeLink)  upgradeLink.style.display  = "none";
      } else {
        if (memberStatus) memberStatus.style.display = "none";
        if (upgradeLink)  upgradeLink.style.display  = "block";
      }
    }

    async function fetchMembershipFromRTDB(user){
      try{
        // owner override
        if (user.uid === OWNER_UID) return "upgraded";

        // try UID
        const uidSnap = await get(child(ref(rtdb), `/members/${user.uid}/level`));
        if (uidSnap.exists()) return uidSnap.val();

        // fallback by email
        if (user.email) {
          const eKey = emailKey(user.email);
          const mailSnap = await get(child(ref(rtdb), `/membersByEmail/${eKey}/level`));
          if (mailSnap.exists()) return mailSnap.val();
        }
      }catch(err){
        console.error('RTDB read error:', err);
      }
      return "starter";
    }

    onAuthStateChanged(auth, async (user) => {
      if (!user) { window.location.href = "login.html"; return; }

      // Keep your existing Firestore behavior:
      await ensureAdmin(user);

      // NEW: Toggle the menu using RTDB (free)
      const level = await fetchMembershipFromRTDB(user);
      await setMenuByLevel(level);

      // Keep your status banner read attempt (Firestore)
      try {
        const snap = await getDoc(doc(db, "users", user.uid));
        if (snap.exists()) {
          const d = snap.data();
          showStatus(`Logged in: ${user.email} ‚Äî membership: ${(d.membership || 'starter').toUpperCase()}${d.role ? ' ‚Ä¢ role: '+d.role : ''}`);
        } else {
          showStatus(`Logged in: ${user.email} ‚Äî no user doc found (will be created on first write).`);
        }
      } catch (e) {
        console.error('Read user doc error:', e);
      }
    });
  </script>

</body>
</html>
